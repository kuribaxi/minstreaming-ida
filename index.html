<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Min Streamingsida</title>
    <link href="https://vjs.zencdn.net/8.10.0/video-js.css" rel="stylesheet" />
    <style>
        body { 
            margin: 0; 
            background: #1a1a1a; 
            color: #fff; 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            display: flex; 
            height: 100vh; 
        }
        .container { 
            display: flex; 
            width: 100%; 
            max-width: 1200px; 
            margin: 0 auto; 
        }
        .favorites-sidebar { 
            width: 200px; 
            overflow-y: auto; 
            padding-right: 20px; 
        }
        .channel-sidebar {
            width: 200px;
            order: 2;
            overflow-y: auto;
            padding-left: 20px;
        }
        h1 { 
            text-align: center; 
            font-size: 2em; 
            margin-bottom: 20px; 
            color: #e50914; 
        }
        .category { 
            margin-bottom: 20px; 
        }
        .category h2 { 
            font-size: 1.5em; 
            margin-bottom: 10px; 
            border-bottom: 2px solid #e50914; 
            display: inline-block; 
        }
        .channel-list { 
            display: flex; 
            flex-direction: column; 
            gap: 10px; 
        }
        .channel { 
            background: #333; 
            padding: 10px; 
            text-align: center; 
            cursor: pointer; 
            border-radius: 5px; 
            transition: background 0.3s; 
            position: relative;
        }
        .channel:hover { 
            background: #e50914; 
        }
        .content { 
            flex: 1; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            order: 1;
        }
        .video-container { 
            width: 100%; 
            max-width: 800px; 
            margin: 20px 0; 
            display: none;
        }
        .fav-btn {
            position: absolute;
            right: 5px;
            top: 5px;
            background: none;
            border: none;
            color: #fff;
            cursor: pointer;
            font-size: 16px;
        }
        .fav-btn:hover {
            color: #e50914;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="favorites-sidebar">
            <h1>Favoriter</h1>
            <div id="favoritesList" class="channel-list"></div>
        </div>
        <div class="content">
            <div class="video-container">
                <video id="main-video" class="video-js vjs-default-skin" controls width="100%" height="450">
                    <source src="" type="application/x-mpegURL">
                </video>
            </div>
        </div>
        <div class="channel-sidebar">
            <h1>Kanallista</h1>
            <div id="categories">
                <div class="category">
                    <h2>Nyheter</h2>
                    <div class="channel-list" id="newsChannels"></div>
                </div>
                <div class="category">
                    <h2>Musik</h2>
                    <div class="channel-list" id="musicChannels"></div>
                </div>
                <div class="category">
                    <h2>Underhållning</h2>
                    <div class="channel-list" id="entertainmentChannels"></div>
                </div>
                <div class="category">
                    <h2>Barn</h2>
                    <div class="channel-list" id="kidsChannels"></div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://vjs.zencdn.net/8.10.0/video.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const mainPlayer = videojs('main-video', {
                fluid: true,
                responsive: true,
                html5: {
                    hls: {
                        overrideNative: true
                    }
                }
            });

            const videoContainer = document.querySelector('.video-container');
            let favorites = JSON.parse(localStorage.getItem('favorites')) || [];

            function formatChannelName(url) {
                const namePart = url.split('/').pop().replace('.html', '').replace(/-/g, ' ');
                return namePart.split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
            }

            const channels = {
                // [Samma kanallista som i originalkoden...]
                news: [
                    // ... (oförändrad)
                ],
                music: [
                    // ... (oförändrad)
                ],
                entertainment: [
                    // ... (oförändrad)
                ],
                kids: [
                    // ... (oförändrad)
                ]
            };

            function updateFavorites() {
                const favList = document.getElementById('favoritesList');
                favList.innerHTML = '';
                favorites.forEach(channel => {
                    const channelDiv = createChannelElement(channel);
                    favList.appendChild(channelDiv);
                });
                localStorage.setItem('favorites', JSON.stringify(favorites));
            }

            function createChannelElement(channel) {
                const channelDiv = document.createElement('div');
                channelDiv.className = 'channel';
                channelDiv.textContent = channel.name;

                const favBtn = document.createElement('button');
                favBtn.className = 'fav-btn';
                favBtn.textContent = favorites.some(f => f.url === channel.url) ? '★' : '☆';
                favBtn.onclick = (e) => {
                    e.stopPropagation();
                    toggleFavorite(channel);
                };
                channelDiv.appendChild(favBtn);

                if (!channel.redirect) {
                    channelDiv.addEventListener('mouseenter', () => {
                        videoContainer.style.display = 'block';
                        playStream(channel.url);
                    });
                    channelDiv.addEventListener('mouseleave', () => {
                        mainPlayer.pause();
                    });
                }
                channelDiv.addEventListener('click', () => handleChannelClick(channel));
                return channelDiv;
            }

            function toggleFavorite(channel) {
                const index = favorites.findIndex(f => f.url === channel.url);
                if (index === -1) {
                    favorites.push(channel);
                } else {
                    favorites.splice(index, 1);
                }
                updateFavorites();
                generateChannels(); // Uppdatera stjärnorna i kanallistan
            }

            function generateChannels() {
                console.log("Genererar kanaler...");
                const newsList = document.getElementById('newsChannels');
                const musicList = document.getElementById('musicChannels');
                const entertainmentList = document.getElementById('entertainmentChannels');
                const kidsList = document.getElementById('kidsChannels');

                if (!newsList || !musicList || !entertainmentList || !kidsList) {
                    console.error("Ett eller flera element saknas");
                    return;
                }

                [newsList, musicList, entertainmentList, kidsList].forEach(list => list.innerHTML = '');

                Object.keys(channels).forEach(category => {
                    channels[category].forEach(channel => {
                        const channelDiv = createChannelElement(channel);
                        document.getElementById(`${category}Channels`).appendChild(channelDiv);
                    });
                });
                console.log("Kanallistan har genererats.");
            }

            function handleChannelClick(channel) {
                console.log("Klickade på kanal: " + channel.name);
                videoContainer.style.display = 'none';
                mainPlayer.pause();

                if (channel.redirect && channel.newTab) {
                    console.log("Öppnar i nytt fönster: " + channel.url);
                    window.open(channel.url, channel.name, 'width=800,height=450,scrollbars=yes,resizable=yes');
                } else {
                    console.log("Spelar upp ström: " + channel.url);
                    videoContainer.style.display = 'block';
                    playStream(channel.url);
                }
            }

            function playStream(url) {
                console.log("Försöker spela upp: " + url);
                mainPlayer.src({
                    src: url,
                    type: 'application/x-mpegURL'
                });
                mainPlayer.ready(function () {
                    mainPlayer.play().catch(error => {
                        console.error("Uppspelningsfel för " + url + ":", error);
                        alert("Kunde inte spela upp strömmen. Det kan bero på CORS, en trasig länk eller serverproblem.");
                    });
                });
            }

            try {
                generateChannels();
                updateFavorites();
            } catch (error) {
                console.error("Fel vid generering av kanaler:", error);
            }
        });
    </script>
</body>
</html>
