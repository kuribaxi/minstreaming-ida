<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Min Streamingsida</title>
    <link href="https://vjs.zencdn.net/8.10.0/video-js.css" rel="stylesheet" />
    <style>
        body { 
            margin: 0; 
            background: #1a1a1a; 
            color: #fff; 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            display: flex; 
            height: 100vh; 
        }
        .container { 
            display: flex; 
            width: 100%; 
            max-width: 1200px; 
            margin: 0 auto; 
        }
        .favorites-sidebar { 
            width: 200px; 
            overflow-y: auto; 
            padding-right: 20px; 
        }
        .channel-sidebar {
            width: 200px;
            order: 2;
            overflow-y: auto;
            padding-left: 20px;
        }
        h1 { 
            text-align: center; 
            font-size: 2em; 
            margin-bottom: 20px; 
            color: #e50914; 
        }
        .category, .fav-category { 
            margin-bottom: 20px; 
        }
        .category h2, .fav-category h2 { 
            font-size: 1.5em; 
            margin-bottom: 10px; 
            border-bottom: 2px solid #e50914; 
            display: inline-block; 
        }
        .channel-list { 
            display: flex; 
            flex-direction: column; 
            gap: 10px; 
        }
        .channel { 
            background: #333; 
            padding: 10px; 
            text-align: center; 
            cursor: pointer; 
            border-radius: 5px; 
            transition: background 0.3s; 
            position: relative;
            display: flex;
            align-items: center;
        }
        .channel:hover { 
            background: #e50914; 
        }
        .content { 
            flex: 1; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            order: 1;
        }
        .video-container { 
            width: 100%; 
            max-width: 800px; 
            margin: 20px 0; 
            display: none;
        }
        .fav-btn {
            background: none;
            border: none;
            color: #fff;
            cursor: pointer;
            font-size: 16px;
            margin-right: 5px;
        }
        .fav-btn:hover {
            color: #e50914;
        }
        .channel-name {
            flex: 1;
            text-align: left;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="favorites-sidebar">
            <div class="fav-category">
                <h1>Favoritlista 1</h1>
                <div id="favoritesList1" class="channel-list"></div>
            </div>
            <div class="fav-category">
                <h1>Favoritlista 2</h1>
                <div id="favoritesList2" class="channel-list"></div>
            </div>
            <div class="fav-category">
                <h1>Favoritlista 3</h1>
                <div id="favoritesList3" class="channel-list"></div>
            </div>
        </div>
        <div class="content">
            <div class="video-container">
                <video id="main-video" class="video-js vjs-default-skin" controls width="100%" height="450">
                    <source src="" type="application/x-mpegURL">
                </video>
            </div>
        </div>
        <div class="channel-sidebar">
            <h1>Kanallista</h1>
            <div id="categories">
                <div class="category">
                    <h2>Nyheter</h2>
                    <div class="channel-list" id="newsChannels"></div>
                </div>
                <div class="category">
                    <h2>Musik</h2>
                    <div class="channel-list" id="musicChannels"></div>
                </div>
                <div class="category">
                    <h2>Underhållning</h2>
                    <div class="channel-list" id="entertainmentChannels"></div>
                </div>
                <div class="category">
                    <h2>Barn</h2>
                    <div class="channel-list" id="kidsChannels"></div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://vjs.zencdn.net/8.10.0/video.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            console.log("DOM laddad, börjar initiera...");

            const mainPlayer = videojs('main-video', {
                fluid: true,
                responsive: true,
                html5: {
                    hls: {
                        overrideNative: true
                    }
                }
            });

            const videoContainer = document.querySelector('.video-container');
            let favorites = JSON.parse(localStorage.getItem('favorites')) || { list1: [], list2: [], list3: [] };
            let shownErrors = new Set();

            function formatChannelName(url) {
                const namePart = url.split('/').pop().replace('.html', '').replace(/-/g, ' ');
                return namePart.split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
            }

            const channels = {
                news: [
                    { name: "Zagros", url: "https://5a3ed7a72ed4b.streamlock.net/zagrostv/SMIL:myStream.smil/playlist.m3u8" },
                    { name: "Zoom", url: "https://live.zoomnews.info/live/Zoom_playlist.m3u8" },
                    { name: "Kanal8", url: "https://live.channel8.com/Channel8-Kurdish/index.fmp4.m3u8" },
                    { name: "Rudaw", url: "https://svs.itworkscdn.net/rudawlive/rudawlive.smil/playlist.m3u8" },
                    { name: "Kurdsat News", url: "https://kurdsat-news.akamaized.net/hls/kurdsat-news.m3u8" },
                    { name: "Sterk", url: "https://muzkurd.com/sterktv/sterk/chunklist_w913361557.m3u8" },
                    { name: "NRT News", url: "https://media.streambrothers.com:1936/8226/8226/playlist.m3u8" },
                    { name: "Kurdistan24", url: "https://d1x82nydcxndze.cloudfront.net/live/index_720p25.m3u8" },
                    { name: formatChannelName("https://karwan.tv/kurdsat-news-tv.html"), url: "https://karwan.tv/kurdsat-news-tv.html", redirect: true, newTab: true },
                    { name: formatChannelName("https://karwan.tv/mmn-news.html"), url: "https://karwan.tv/mmn-news.html", redirect: true, newTab: true },
                    { name: formatChannelName("https://karwan.tv/shams-tv.html"), url: "https://karwan.tv/shams-tv.html", redirect: true, newTab: true }
                ],
                music: [
                    { name: "4 Kurd", url: "https://4kuhls.persiana.live/hls/stream.m3u8" },
                    { name: "Med Music", url: "http://54.36.110.140/live3/live3.m3u8" },
                    { name: formatChannelName("https://karwan.tv/med-muzik-tv.html"), url: "https://karwan.tv/med-muzik-tv.html", redirect: true, newTab: true },
                    { name: formatChannelName("https://karwan.tv/mmn-clip.html"), url: "https://karwan.tv/mmn-clip.html", redirect: true, newTab: true },
                    { name: formatChannelName("https://karwan.tv/graryan-tv.html"), url: "https://karwan.tv/graryan-tv.html", redirect: true, newTab: true },
                    { name: formatChannelName("https://karwan.tv/kanal-21.html"), url: "https://karwan.tv/kanal-21.html", redirect: true, newTab: true },
                    { name: formatChannelName("https://karwan.tv/kurd-7.html"), url: "https://karwan.tv/kurd-7.html", redirect: true, newTab: true }
                ],
                entertainment: [
                    { name: "Aryen", url: "https://aryen.tv/live/tv/playlist.m3u8" },
                    { name: "Cira", url:-
                    { name: "Bangewaz", url: "https://bangewaz.live/hls/stream.m3u8" },
                    { name: "Bangxwazen-badinan", url: "https://karwan.tv/bangxwazen-badinan-tv.html", redirect: true, newTab: true }
                ],
                kids: [
                    { name: "Baxche", url: "https://5dcabf026b188.streamlock.net/afarinTV/livestream/playlist.m3u8" },
                    { name: "Afarin Kids", url: "https://65f16f0fdfc51.streamlock.net/afarinTV/livestream/playlist.m3u8" }
                ]
            };

            function updateFavorites() {
                const favLists = {
                    list1: document.getElementById('favoritesList1'),
                    list2: document.getElementById('favoritesList2'),
                    list3: document.getElementById('favoritesList3')
                };
                if (!favLists.list1 || !favLists.list2 || !favLists.list3) {
                    console.error("Favoritlista-element saknas i DOM");
                    return;
                }
                Object.keys(favLists).forEach(list => {
                    favLists[list].innerHTML = '';
                    favorites[list].forEach(channel => {
                        const channelDiv = createChannelElement(channel);
                        favLists[list].appendChild(channelDiv);
                    });
                });
                localStorage.setItem('favorites', JSON.stringify(favorites));
            }

            function createChannelElement(channel) {
                const channelDiv = document.createElement('div');
                channelDiv.className = 'channel';

                const favBtn1 = document.createElement('button');
                favBtn1.className = 'fav-btn';
                favBtn1.textContent = favorites.list1.some(f => f.url === channel.url) ? '★' : '☆';
                favBtn1.onclick = (e) => { e.stopPropagation(); toggleFavorite(channel, 'list1'); };

                const favBtn2 = document.createElement('button');
                favBtn2.className = 'fav-btn';
                favBtn2.textContent = favorites.list2.some(f => f.url === channel.url) ? '★' : '☆';
                favBtn2.onclick = (e) => { e.stopPropagation(); toggleFavorite(channel, 'list2'); };

                const favBtn3 = document.createElement('button');
                favBtn3.className = 'fav-btn';
                favBtn3.textContent = favorites.list3.some(f => f.url === channel.url) ? '★' : '☆';
                favBtn3.onclick = (e) => { e.stopPropagation(); toggleFavorite(channel, 'list3'); };

                const channelName = document.createElement('span');
                channelName.className = 'channel-name';
                channelName.textContent = channel.name;

                channelDiv.appendChild(favBtn1);
                channelDiv.appendChild(favBtn2);
                channelDiv.appendChild(favBtn3);
                channelDiv.appendChild(channelName);

                if (!channel.redirect) {
                    channelDiv.addEventListener('mouseenter', () => {
                        videoContainer.style.display = 'block';
                        playStream(channel.url);
                    });
                    channelDiv.addEventListener('mouseleave', () => {
                        mainPlayer.pause();
                    });
                }
                channelDiv.addEventListener('click', () => handleChannelClick(channel));
                return channelDiv;
            }

            function toggleFavorite(channel, listName) {
                ['list1', 'list2', 'list3'].forEach(list => {
                    const index = favorites[list].findIndex(f => f.url === channel.url);
                    if (index !== -1) favorites[list].splice(index, 1);
                });
                if (!favorites[listName].some(f => f.url === channel.url)) {
                    favorites[listName].push(channel);
                }
                updateFavorites();
                generateChannels();
            }

            function generateChannels() {
                console.log("Genererar kanaler...");
                const newsList = document.getElementById('newsChannels');
                const musicList = document.getElementById('musicChannels');
                const entertainmentList = document.getElementById('entertainmentChannels');
                const kidsList = document.getElementById('kidsChannels');

                if (!newsList || !musicList || !entertainmentList || !kidsList) {
                    console.error("Ett eller flera kanallista-element saknas i DOM");
                    return;
                }

                newsList.innerHTML = '';
                musicList.innerHTML = '';
                entertainmentList.innerHTML = '';
                kidsList.innerHTML = '';

                Object.keys(channels).forEach(category => {
                    console.log(`Bearbetar kategori: ${category}, antal kanaler: ${channels[category].length}`);
                    const channelList = document.getElementById(`${category}Channels`);
                    channels[category].forEach(channel => {
                        console.log(`Lägger till kanal: ${channel.name}`);
                        const channelDiv = createChannelElement(channel);
                        channelList.appendChild(channelDiv);
                    });
                });
                console.log("Kanallistan har genererats.");
            }

            function handleChannelClick(channel) {
                console.log("Klickade på kanal: " + channel.name);
                videoContainer.style.display = 'none';
                mainPlayer.pause();

                if (channel.redirect && channel.newTab) {
                    console.log("Öppnar i nytt fönster: " + channel.url);
                    window.open(channel.url, channel.name, 'width=800,height=450,scrollbars=yes,resizable=yes');
                } else {
                    console.log("Spelar upp ström: " + channel.url);
                    videoContainer.style.display = 'block';
                    playStream(channel.url);
                }
            }

            function playStream(url) {
                console.log("Försöker spela upp: " + url);
                mainPlayer.src({
                    src: url,
                    type: 'application/x-mpegURL'
                });
                mainPlayer.ready(function () {
                    mainPlayer.play().catch(error => {
                        console.error("Uppspelningsfel för " + url + ":", error);
                        if (!shownErrors.has(url)) {
                            alert("Kunde inte spela upp strömmen. Det kan bero på CORS, en trasig länk eller serverproblem.");
                            shownErrors.add(url);
                        }
                    });
                });
            }

            try {
                console.log("Försöker generera kanaler och uppdatera favoriter...");
                generateChannels();
                updateFavorites();
                console.log("Initiering klar.");
            } catch (error) {
                console.error("Fel vid initiering:", error);
            }
        });
    </script>
</body>
</html>
